/* empty css             */import{E as we,v as ye}from"./el-divider-ecc359a5.js";import{f as ve}from"./el-overlay-f72fc15d.js";import{E as he,a as be}from"./el-descriptions-item-dca51dca.js";import{E as Ce}from"./el-card-2e3e2287.js";import{E as xe,a as Ve}from"./el-form-item-05a4ac01.js";import{E as Ue,a as Ee}from"./el-input-9fa91db1.js";import{f as ke,g as Se}from"./el-select-09ad9e4a.js";import"./el-icon-44e96953.js";import{aF as T,aG as qe,aO as De,d as Re,r as V,a as P,O as Be,a6 as U,c as D,e as Ne,Z,i as a,A as N,w as r,h as i,f as e,j as o,D as b,$ as H,ay as J,E as _,C as Te,p as Ae,k as Fe,_ as Pe}from"./index-44b05c72.js";import{b as je,a as G}from"./index-b36a6823.js";import{u as Le}from"./setting-1c466c73.js";const Ie=c=>T.post("/admin/create_user",c),Oe=c=>T.post("/admin/ban_user",c),Qe=c=>T.post("/admin/query_user",c),$e=c=>T.post("/admin/activate_user",c),ze=c=>T.post("/admin/renew_user",c);let Ze=qe("admin",()=>({userCreate:async f=>{try{const n=De(f.password).toString();return f.password=n,await Ie(f)}catch(n){return Promise.reject(n)}},userBan:async f=>{try{return await Oe(f)}catch(n){return Promise.reject(n)}},userQuery:async f=>{try{return await Qe(f)}catch(n){return Promise.reject(n)}},userActivate:async f=>{try{return await $e(f)}catch(n){return Promise.reject(n)}},userRenew:async f=>{try{return await ze(f)}catch(n){return Promise.reject(n)}}}));const Ge=Ze,R=c=>(Ae("data-v-a5f0a344"),c=c(),Fe(),c),He=R(()=>i("div",{class:"card-header"},"新建用户",-1)),Je={class:"card-footer"},Ke=R(()=>i("span",{style:{"margin-left":"12px",color:"dimgray"}},"使用管理权限新建用户",-1)),Me=R(()=>i("div",{class:"card-header"},"用户操作",-1)),We={class:"card-footer"},Xe=R(()=>i("span",{style:{"margin-left":"12px",color:"dimgray"}},"查询、封禁或激活用户，激活会将用户提升为普通权限",-1)),Ye={class:"userinfo-cell-item"},er={class:"userinfo-cell-item"},rr={class:"userinfo-cell-item"},sr={class:"userinfo-cell-item"},tr={class:"userinfo-cell-item"},ar={class:"userinfo-cell-item"},lr=R(()=>i("div",{class:"card-header"},"用户续期",-1)),or={class:"card-footer"},ir=R(()=>i("span",{style:{"margin-left":"12px",color:"dimgray"}},"延长用户的有效期，以小时为单位",-1)),nr={style:{"margin-right":"12px"}},ur={class:"dialog-footer"},mr=Re({__name:"index",setup(c){let j=Le(),E=Ge(),k=V(null),u=P({username:"",password:"",repassword:"",permission:"1"}),f=()=>{u.username="",u.password="",u.repassword="",u.permission="1";try{setTimeout(()=>{k.value&&k.value.clearValidate(["username","password","repassword","permission"])},200)}catch(s){console.log(s)}},n=(s,t,p)=>{/^[a-zA-Z0-9]+$/.test(t)?p():p(new Error("用户名只能是大小英文以及数字"))};const M={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:5,max:12,message:"用户名长度为5到12位",trigger:"blur"},{validator:n,trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}],repassword:[{required:!0,message:"请确认密码",trigger:"blur"},{validator:(s,t,p)=>{t!==u.password?p(new Error("输入的密码不相同")):p()},trigger:"blur"}],permission:[{required:!0,message:"请选择权限",trigger:"blur"}]};let L=V(!1),W=async()=>{k.value&&await k.value.validate();try{L.value=!0;let s={username:"",password:"",permission:1};s.username=u.username,s.password=u.password,s.permission=Number(u.permission);let t=await E.userCreate(s);t.success?(_({type:"success",message:t.message,duration:3e3}),f()):_({type:"error",message:t.message,duration:3e3})}catch(s){_({type:"error",message:s.message,duration:3e3})}finally{L.value=!1}},C=V(!1),x=V(null),v=P({username:""});const X={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:5,max:12,message:"用户名长度为5到12位",trigger:"blur"},{validator:n,trigger:"blur"}]};let l=P({username:"暂无信息",permission:"暂无信息",expire_at:"暂无信息",game_id:"暂无信息",create_at:"暂无信息",update_at:"暂无信息"}),Y=s=>{l.username=s.username,s.permission==0?l.permission="封禁":s.permission==1?l.permission="游客":s.permission==2?l.permission="普通":s.permission==3?l.permission="开发者":s.permission==4?l.permission="管理员":l.permission="未知",l.permission+=`(${s.permission})`;let t=G(s.expire_at.toString()),p=G(s.create_at.toString()),m=G(s.update_at.toString());l.expire_at=t,l.create_at=p,l.update_at=m,s.game_id==0?l.game_id="暂未获取":l.game_id=s.game_id.toString()},ee=()=>{l.username="暂无信息",l.game_id="暂无信息",l.permission="暂无信息",l.expire_at="暂无信息",l.create_at="暂无信息",l.update_at="暂无信息"},A=async()=>{x.value&&await x.value.validate();try{C.value=!0;let s={username:""};s.username=v.username;let t=await E.userQuery(s);t.success?(_({type:"success",message:t.message,duration:3e3}),Y(t.user)):(_({type:"error",message:t.message,duration:3e3}),ee())}catch(s){_({type:"error",message:s.message,duration:3e3})}finally{C.value=!1}},re=async()=>{x.value&&await x.value.validate();try{C.value=!0;let s={username:""};s.username=v.username;let t=await E.userActivate(s);t.success?(_({type:"success",message:t.message,duration:3e3}),A()):_({type:"error",message:t.message,duration:3e3})}catch(s){_({type:"error",message:s.message,duration:3e3})}finally{C.value=!1}},w=V(!1),se=async()=>{x.value&&await x.value.validate(),w.value=!0},te=async()=>{w.value=!1;try{C.value=!0;let s={username:""};s.username=v.username;let t=await E.userBan(s);t.success?(_({type:"success",message:t.message,duration:3e3}),A()):_({type:"error",message:t.message,duration:3e3})}catch(s){_({type:"error",message:s.message,duration:3e3})}finally{C.value=!1}},B=V(null),y=P({username:"",renew_time:""}),ae=Be(()=>je(y.renew_time)),le=()=>{y.renew_time="";try{setTimeout(()=>{B.value&&B.value.clearValidate(["renew_time"])},200)}catch(s){console.log(s)}};const oe={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:5,max:12,message:"用户名长度为5到12位",trigger:"blur"},{validator:n,trigger:"blur"}],renew_time:[{required:!0,message:"请输入续期时长",trigger:"blur"},{validator:(s,t,p)=>{const m=parseInt(t,10);isNaN(m)||m<=0||m!==parseFloat(t)?p(new Error("请输入正整数")):m>86400?p(new Error("超出最大续期时长")):p()},trigger:"blur"}]};let I=V(!1),ie=async()=>{B.value&&await B.value.validate();try{I.value=!0;let s={username:"",renew_time:0};s.username=y.username,s.renew_time=Number(y.renew_time)*3600;let t=await E.userRenew(s);t.success?(_({type:"success",message:t.message,duration:3e3}),le(),v.username=s.username,A()):_({type:"error",message:t.message,duration:3e3})}catch(s){_({type:"error",message:s.message,duration:3e3})}finally{I.value=!1}};return(s,t)=>{const p=U("ChatDotRound"),m=Te,O=we,S=Ue,g=xe,F=ke,ne=Se,h=Ee,Q=Ve,$=Ce,ue=U("UserFilled"),q=he,me=U("Coordinate"),de=U("Tools"),ce=U("SwitchButton"),pe=U("Connection"),_e=U("Refresh"),fe=be,ge=ve,z=ye;return D(),Ne("div",null,[Z((D(),N($,{shadow:"hover"},{header:r(()=>[He]),default:r(()=>[i("div",null,[i("div",Je,[e(m,null,{default:r(()=>[e(p)]),_:1}),Ke]),e(O),e(Q,{class:"admin-create-form-container",model:a(u),rules:M,ref_key:"createform",ref:k},{default:r(()=>[e(g,{prop:"username"},{default:r(()=>[e(S,{"prefix-icon":"User",modelValue:a(u).username,"onUpdate:modelValue":t[0]||(t[0]=d=>a(u).username=d),placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1}),e(g,{prop:"password"},{default:r(()=>[e(S,{"prefix-icon":"Lock",type:"password","show-password":"",modelValue:a(u).password,"onUpdate:modelValue":t[1]||(t[1]=d=>a(u).password=d),placeholder:"请输入密码"},null,8,["modelValue"])]),_:1}),e(g,{prop:"repassword"},{default:r(()=>[e(S,{"prefix-icon":"Lock",type:"password","show-password":"",modelValue:a(u).repassword,"onUpdate:modelValue":t[2]||(t[2]=d=>a(u).repassword=d),placeholder:"请确认密码"},null,8,["modelValue"])]),_:1}),e(g,{prop:"permission"},{default:r(()=>[e(ne,{modelValue:a(u).permission,"onUpdate:modelValue":t[3]||(t[3]=d=>a(u).permission=d),class:"m-2",placeholder:"游客"},{default:r(()=>[e(F,{label:"封禁",value:"0"}),e(F,{label:"游客",value:"1"}),e(F,{label:"普通",value:"2"}),e(F,{label:"开发者",value:"3"})]),_:1},8,["modelValue"])]),_:1}),e(g,{style:{"margin-bottom":"0"}},{default:r(()=>[e(h,{type:"primary",onClick:a(W)},{default:r(()=>[o("新建")]),_:1},8,["onClick"]),e(h,{onClick:a(f)},{default:r(()=>[o("清空表单")]),_:1},8,["onClick"])]),_:1})]),_:1},8,["model"])])]),_:1})),[[z,a(L)]]),Z((D(),N($,{shadow:"hover",style:{"margin-top":"12px"}},{header:r(()=>[Me]),default:r(()=>[i("div",null,[i("div",We,[e(m,null,{default:r(()=>[e(p)]),_:1}),Xe]),e(O),e(Q,{class:"admin-option-form-container",model:a(v),rules:X,ref_key:"optionform",ref:x},{default:r(()=>[e(g,{style:{"max-width":"400px"},label:"用户名",prop:"username"},{default:r(()=>[e(S,{modelValue:a(v).username,"onUpdate:modelValue":t[4]||(t[4]=d=>a(v).username=d),placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1}),e(g,null,{default:r(()=>[e(fe,{style:{width:"100%"},class:"margin-top",direction:a(j).infoDirection,column:a(j).infoCol,size:"default",border:""},{default:r(()=>[e(q,null,{label:r(()=>[i("div",Ye,[e(m,{class:"userinfo-cell-item-icon"},{default:r(()=>[e(ue)]),_:1}),o(" 用户名 ")])]),default:r(()=>[o(" "+b(a(l).username),1)]),_:1}),e(q,null,{label:r(()=>[i("div",er,[e(m,{class:"userinfo-cell-item-icon"},{default:r(()=>[e(me)]),_:1}),o(" 游戏 ID ")])]),default:r(()=>[o(" "+b(a(l).game_id),1)]),_:1}),e(q,null,{label:r(()=>[i("div",rr,[e(m,{class:"userinfo-cell-item-icon"},{default:r(()=>[e(de)]),_:1}),o(" 权限 ")])]),default:r(()=>[o(" "+b(a(l).permission),1)]),_:1}),e(q,null,{label:r(()=>[i("div",sr,[e(m,{class:"userinfo-cell-item-icon"},{default:r(()=>[e(ce)]),_:1}),o(" 有效期至 ")])]),default:r(()=>[o(" "+b(a(l).expire_at),1)]),_:1}),e(q,null,{label:r(()=>[i("div",tr,[e(m,{class:"userinfo-cell-item-icon"},{default:r(()=>[e(pe)]),_:1}),o(" 创建时间 ")])]),default:r(()=>[o(" "+b(a(l).create_at),1)]),_:1}),e(q,null,{label:r(()=>[i("div",ar,[e(m,{class:"userinfo-cell-item-icon"},{default:r(()=>[e(_e)]),_:1}),o(" 更新时间 ")])]),default:r(()=>[o(" "+b(a(l).update_at),1)]),_:1})]),_:1},8,["direction","column"])]),_:1}),e(g,{style:{"margin-bottom":"0"}},{default:r(()=>[e(h,{type:"primary",onClick:a(A)},{default:r(()=>[o("查询")]),_:1},8,["onClick"]),["封禁(0)","游客(1)"].includes(a(l).permission)?(D(),N(h,{key:0,type:"success",onClick:a(re)},{default:r(()=>[o("激活 ")]),_:1},8,["onClick"])):H("",!0),["游客(1)","普通(2)","开发者(3)"].includes(a(l).permission)?(D(),N(h,{key:1,type:"danger",onClick:a(se)},{default:r(()=>[o("封禁 ")]),_:1},8,["onClick"])):H("",!0)]),_:1})]),_:1},8,["model"])])]),_:1})),[[z,a(C)]]),Z((D(),N($,{shadow:"hover",style:{"margin-top":"12px"}},{header:r(()=>[lr]),default:r(()=>[i("div",null,[i("div",or,[e(m,null,{default:r(()=>[e(p)]),_:1}),ir]),e(O),e(Q,{class:"admin-renew-form-container",model:a(y),rules:oe,ref_key:"renewform",ref:B},{default:r(()=>[e(g,{label:"用户名称",prop:"username"},{default:r(()=>[e(S,{modelValue:a(y).username,"onUpdate:modelValue":t[5]||(t[5]=d=>a(y).username=d),placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1}),e(g,{label:"续期时长",prop:"renew_time"},{default:r(()=>[e(S,{modelValue:a(y).renew_time,"onUpdate:modelValue":t[6]||(t[6]=d=>a(y).renew_time=d),type:"number",placeholder:"请输入时长(小时)",min:"1",max:"86400"},null,8,["modelValue"])]),_:1}),e(g,{style:{"margin-bottom":"0"}},{default:r(()=>[i("span",nr,b(a(ae)),1),e(h,{type:"primary",onClick:a(ie)},{default:r(()=>[o("续期")]),_:1},8,["onClick"])]),_:1})]),_:1},8,["model"])])]),_:1})),[[z,a(I)]]),e(ge,{width:"300px",modelValue:a(w),"onUpdate:modelValue":t[8]||(t[8]=d=>J(w)?w.value=d:w=d),title:"封禁","align-center":""},{footer:r(()=>[i("span",ur,[e(h,{onClick:t[7]||(t[7]=d=>J(w)?w.value=!1:w=!1)},{default:r(()=>[o("取消")]),_:1}),e(h,{type:"primary",onClick:a(te)},{default:r(()=>[o("确定")]),_:1},8,["onClick"])])]),default:r(()=>[o(" 确定封禁 "+b(a(v).username)+" 吗？ ",1)]),_:1},8,["modelValue"])])}}});const Vr=Pe(mr,[["__scopeId","data-v-a5f0a344"]]);export{Vr as default};
