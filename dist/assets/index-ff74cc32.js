/* empty css             */import{E as we,v as ye}from"./el-divider-b29d1674.js";import{f as ve}from"./el-overlay-bdc6a596.js";import{E as he,a as be}from"./el-descriptions-item-af0d124c.js";import{E as Ce}from"./el-card-7ce17afd.js";import{E as xe,a as Ve}from"./el-form-item-e36cdca3.js";import{E as Ue,a as Ee}from"./el-input-10cd3bf3.js";import{f as Se,g as ke}from"./el-select-5fa84abb.js";import"./el-icon-ddec6614.js";import{aF as T,aG as qe,aO as De,d as Re,r as V,a as P,O as Be,a6 as U,c as D,e as Ne,Z,i as a,A as N,w as r,h as i,f as e,j as o,a7 as Te,D as b,$ as M,ay as H,E as _,C as Ae,p as Fe,k as Pe,_ as je}from"./index-1fb0ff9b.js";import{b as Le,a as G}from"./index-b36a6823.js";import{u as Ie}from"./setting-81fc4885.js";const Oe=c=>T.post("/admin/create_user",c),Qe=c=>T.post("/admin/ban_user",c),$e=c=>T.post("/admin/query_user",c),ze=c=>T.post("/admin/activate_user",c),Ze=c=>T.post("/admin/renew_user",c);let Ge=qe("admin",()=>({userCreate:async f=>{try{const n=De(f.password).toString();return f.password=n,await Oe(f)}catch(n){return Promise.reject(n)}},userBan:async f=>{try{return await Qe(f)}catch(n){return Promise.reject(n)}},userQuery:async f=>{try{return await $e(f)}catch(n){return Promise.reject(n)}},userActivate:async f=>{try{return await ze(f)}catch(n){return Promise.reject(n)}},userRenew:async f=>{try{return await Ze(f)}catch(n){return Promise.reject(n)}}}));const Me=Ge,R=c=>(Fe("data-v-c2f04a5a"),c=c(),Pe(),c),He=R(()=>i("div",{class:"card-header"},"新建用户",-1)),Je={class:"card-footer"},Ke=R(()=>i("span",{style:{"margin-left":"12px",color:"dimgray"}},"使用管理权限新建用户",-1)),We=R(()=>i("div",{class:"card-header"},"用户操作",-1)),Xe={class:"card-footer"},Ye=R(()=>i("span",{style:{"margin-left":"12px",color:"dimgray"}},"查询、封禁或激活用户，激活会将用户提升为普通权限",-1)),er={class:"userinfo-cell-item"},rr={class:"userinfo-cell-item"},sr={class:"userinfo-cell-item"},tr={class:"userinfo-cell-item"},ar={class:"userinfo-cell-item"},lr={class:"userinfo-cell-item"},or=R(()=>i("div",{class:"card-header"},"用户续期",-1)),ir={class:"card-footer"},nr=R(()=>i("span",{style:{"margin-left":"12px",color:"dimgray"}},"延长用户的有效期，以小时为单位",-1)),ur={style:{"margin-right":"12px"}},mr={class:"dialog-footer"},dr=Re({__name:"index",setup(c){let j=Ie(),E=Me(),S=V(null),u=P({username:"",password:"",repassword:"",permission:"1"}),f=()=>{u.username="",u.password="",u.repassword="",u.permission="1";try{setTimeout(()=>{S.value&&S.value.clearValidate(["username","password","repassword","permission"])},200)}catch(t){console.log(t)}},n=(t,s,p)=>{/^[a-zA-Z0-9]+$/.test(s)?p():p(new Error("用户名只能是大小英文以及数字"))};const K={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:5,max:12,message:"用户名长度为5到12位",trigger:"blur"},{validator:n,trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}],repassword:[{required:!0,message:"请确认密码",trigger:"blur"},{validator:(t,s,p)=>{s!==u.password?p(new Error("输入的密码不相同")):p()},trigger:"blur"}],permission:[{required:!0,message:"请选择权限",trigger:"blur"}]};let L=V(!1),W=async()=>{S.value&&await S.value.validate();try{L.value=!0;let t={username:"",password:"",permission:1};t.username=u.username,t.password=u.password,t.permission=Number(u.permission);let s=await E.userCreate(t);s.success?(_({type:"success",message:s.message,duration:3e3}),f()):_({type:"error",message:s.message,duration:3e3})}catch(t){_({type:"error",message:t.message,duration:3e3})}finally{L.value=!1}},C=V(!1),x=V(null),v=P({username:""});const X={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:5,max:12,message:"用户名长度为5到12位",trigger:"blur"},{validator:n,trigger:"blur"}]};let l=P({username:"暂无信息",permission:"暂无信息",expire_at:"暂无信息",game_id:"暂无信息",create_at:"暂无信息",update_at:"暂无信息"}),Y=t=>{l.username=t.username,t.permission==0?l.permission="封禁":t.permission==1?l.permission="游客":t.permission==2?l.permission="普通":t.permission==3?l.permission="开发者":t.permission==4?l.permission="管理员":l.permission="未知",l.permission+=`(${t.permission})`;let s=G(t.expire_at.toString()),p=G(t.create_at.toString()),m=G(t.update_at.toString());l.expire_at=s,l.create_at=p,l.update_at=m,t.game_id==0?l.game_id="暂未获取":l.game_id=t.game_id.toString()},ee=()=>{l.username="暂无信息",l.game_id="暂无信息",l.permission="暂无信息",l.expire_at="暂无信息",l.create_at="暂无信息",l.update_at="暂无信息"},A=async()=>{x.value&&await x.value.validate();try{C.value=!0;let t={username:""};t.username=v.username;let s=await E.userQuery(t);s.success?(_({type:"success",message:s.message,duration:3e3}),Y(s.user)):(_({type:"error",message:s.message,duration:3e3}),ee())}catch(t){_({type:"error",message:t.message,duration:3e3})}finally{C.value=!1}},re=async()=>{x.value&&await x.value.validate();try{C.value=!0;let t={username:""};t.username=v.username;let s=await E.userActivate(t);s.success?(_({type:"success",message:s.message,duration:3e3}),A()):_({type:"error",message:s.message,duration:3e3})}catch(t){_({type:"error",message:t.message,duration:3e3})}finally{C.value=!1}},w=V(!1),se=async()=>{x.value&&await x.value.validate(),w.value=!0},te=async()=>{w.value=!1;try{C.value=!0;let t={username:""};t.username=v.username;let s=await E.userBan(t);s.success?(_({type:"success",message:s.message,duration:3e3}),A()):_({type:"error",message:s.message,duration:3e3})}catch(t){_({type:"error",message:t.message,duration:3e3})}finally{C.value=!1}},B=V(null),y=P({username:"",renew_time:""}),ae=Be(()=>Le(y.renew_time)),le=()=>{y.renew_time="";try{setTimeout(()=>{B.value&&B.value.clearValidate(["renew_time"])},200)}catch(t){console.log(t)}};const oe={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:5,max:12,message:"用户名长度为5到12位",trigger:"blur"},{validator:n,trigger:"blur"}],renew_time:[{required:!0,message:"请输入续期时长",trigger:"blur"},{validator:(t,s,p)=>{const m=parseInt(s,10);isNaN(m)||m<=0||m!==parseFloat(s)?p(new Error("请输入正整数")):m>86400?p(new Error("超出最大续期时长")):p()},trigger:"blur"}]};let I=V(!1),ie=async()=>{B.value&&await B.value.validate();try{I.value=!0;let t={username:"",renew_time:0};t.username=y.username,t.renew_time=Number(y.renew_time)*3600;let s=await E.userRenew(t);s.success?(_({type:"success",message:s.message,duration:3e3}),le(),v.username=t.username,A()):_({type:"error",message:s.message,duration:3e3})}catch(t){_({type:"error",message:t.message,duration:3e3})}finally{I.value=!1}};return(t,s)=>{const p=U("ChatDotRound"),m=Ae,O=we,k=Ue,g=xe,F=Se,ne=ke,h=Ee,Q=Ve,$=Ce,ue=U("UserFilled"),q=he,me=U("Coordinate"),de=U("Tools"),ce=U("SwitchButton"),pe=U("Connection"),_e=U("Refresh"),fe=be,ge=ve,z=ye;return D(),Ne("div",null,[Z((D(),N($,{shadow:"hover"},{header:r(()=>[He]),default:r(()=>[i("div",null,[i("div",Je,[e(m,null,{default:r(()=>[e(p)]),_:1}),Ke]),e(O),e(Q,{class:"admin-create-form-container",model:a(u),rules:K,ref_key:"createform",ref:S},{default:r(()=>[e(g,{prop:"username"},{default:r(()=>[e(k,{"prefix-icon":"User",modelValue:a(u).username,"onUpdate:modelValue":s[0]||(s[0]=d=>a(u).username=d),placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1}),e(g,{prop:"password"},{default:r(()=>[e(k,{"prefix-icon":"Lock",type:"password","show-password":"",modelValue:a(u).password,"onUpdate:modelValue":s[1]||(s[1]=d=>a(u).password=d),placeholder:"请输入密码"},null,8,["modelValue"])]),_:1}),e(g,{prop:"repassword"},{default:r(()=>[e(k,{"prefix-icon":"Lock",type:"password","show-password":"",modelValue:a(u).repassword,"onUpdate:modelValue":s[2]||(s[2]=d=>a(u).repassword=d),placeholder:"请确认密码"},null,8,["modelValue"])]),_:1}),e(g,{prop:"permission"},{default:r(()=>[e(ne,{modelValue:a(u).permission,"onUpdate:modelValue":s[3]||(s[3]=d=>a(u).permission=d),class:"m-2",placeholder:"游客"},{default:r(()=>[e(F,{label:"封禁",value:"0"}),e(F,{label:"游客",value:"1"}),e(F,{label:"普通",value:"2"}),e(F,{label:"开发者",value:"3"})]),_:1},8,["modelValue"])]),_:1}),e(g,{style:{"margin-bottom":"0"}},{default:r(()=>[e(h,{type:"primary",onClick:a(W)},{default:r(()=>[o("新建")]),_:1},8,["onClick"]),e(h,{onClick:a(f)},{default:r(()=>[o("清空表单")]),_:1},8,["onClick"])]),_:1})]),_:1},8,["model"])])]),_:1})),[[z,a(L)]]),Z((D(),N($,{shadow:"hover",style:{"margin-top":"12px"}},{header:r(()=>[We]),default:r(()=>[i("div",null,[i("div",Xe,[e(m,null,{default:r(()=>[e(p)]),_:1}),Ye]),e(O),e(Q,{onSubmit:s[5]||(s[5]=Te(()=>{},["prevent"])),class:"admin-option-form-container",model:a(v),rules:X,ref_key:"optionform",ref:x},{default:r(()=>[e(g,{style:{"max-width":"400px"},label:"用户名",prop:"username"},{default:r(()=>[e(k,{modelValue:a(v).username,"onUpdate:modelValue":s[4]||(s[4]=d=>a(v).username=d),placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1}),e(g,null,{default:r(()=>[e(fe,{style:{width:"100%"},class:"margin-top",direction:a(j).infoDirection,column:a(j).infoCol,size:"default",border:""},{default:r(()=>[e(q,null,{label:r(()=>[i("div",er,[e(m,{class:"userinfo-cell-item-icon"},{default:r(()=>[e(ue)]),_:1}),o(" 用户名 ")])]),default:r(()=>[o(" "+b(a(l).username),1)]),_:1}),e(q,null,{label:r(()=>[i("div",rr,[e(m,{class:"userinfo-cell-item-icon"},{default:r(()=>[e(me)]),_:1}),o(" 游戏 ID ")])]),default:r(()=>[o(" "+b(a(l).game_id),1)]),_:1}),e(q,null,{label:r(()=>[i("div",sr,[e(m,{class:"userinfo-cell-item-icon"},{default:r(()=>[e(de)]),_:1}),o(" 权限 ")])]),default:r(()=>[o(" "+b(a(l).permission),1)]),_:1}),e(q,null,{label:r(()=>[i("div",tr,[e(m,{class:"userinfo-cell-item-icon"},{default:r(()=>[e(ce)]),_:1}),o(" 有效期至 ")])]),default:r(()=>[o(" "+b(a(l).expire_at),1)]),_:1}),e(q,null,{label:r(()=>[i("div",ar,[e(m,{class:"userinfo-cell-item-icon"},{default:r(()=>[e(pe)]),_:1}),o(" 创建时间 ")])]),default:r(()=>[o(" "+b(a(l).create_at),1)]),_:1}),e(q,null,{label:r(()=>[i("div",lr,[e(m,{class:"userinfo-cell-item-icon"},{default:r(()=>[e(_e)]),_:1}),o(" 更新时间 ")])]),default:r(()=>[o(" "+b(a(l).update_at),1)]),_:1})]),_:1},8,["direction","column"])]),_:1}),e(g,{style:{"margin-bottom":"0"}},{default:r(()=>[e(h,{type:"primary",onClick:a(A)},{default:r(()=>[o("查询")]),_:1},8,["onClick"]),["封禁(0)","游客(1)"].includes(a(l).permission)?(D(),N(h,{key:0,type:"success",onClick:a(re)},{default:r(()=>[o("激活 ")]),_:1},8,["onClick"])):M("",!0),["游客(1)","普通(2)","开发者(3)"].includes(a(l).permission)?(D(),N(h,{key:1,type:"danger",onClick:a(se)},{default:r(()=>[o("封禁 ")]),_:1},8,["onClick"])):M("",!0)]),_:1})]),_:1},8,["model"])])]),_:1})),[[z,a(C)]]),Z((D(),N($,{shadow:"hover",style:{"margin-top":"12px"}},{header:r(()=>[or]),default:r(()=>[i("div",null,[i("div",ir,[e(m,null,{default:r(()=>[e(p)]),_:1}),nr]),e(O),e(Q,{class:"admin-renew-form-container",model:a(y),rules:oe,ref_key:"renewform",ref:B},{default:r(()=>[e(g,{label:"用户名称",prop:"username"},{default:r(()=>[e(k,{modelValue:a(y).username,"onUpdate:modelValue":s[6]||(s[6]=d=>a(y).username=d),placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1}),e(g,{label:"续期时长",prop:"renew_time"},{default:r(()=>[e(k,{modelValue:a(y).renew_time,"onUpdate:modelValue":s[7]||(s[7]=d=>a(y).renew_time=d),type:"number",placeholder:"请输入时长(小时)",min:"1",max:"86400"},null,8,["modelValue"])]),_:1}),e(g,{style:{"margin-bottom":"0"}},{default:r(()=>[i("span",ur,b(a(ae)),1),e(h,{type:"primary",onClick:a(ie)},{default:r(()=>[o("续期")]),_:1},8,["onClick"])]),_:1})]),_:1},8,["model"])])]),_:1})),[[z,a(I)]]),e(ge,{width:"300px",modelValue:a(w),"onUpdate:modelValue":s[9]||(s[9]=d=>H(w)?w.value=d:w=d),title:"封禁","align-center":""},{footer:r(()=>[i("span",mr,[e(h,{onClick:s[8]||(s[8]=d=>H(w)?w.value=!1:w=!1)},{default:r(()=>[o("取消")]),_:1}),e(h,{type:"primary",onClick:a(te)},{default:r(()=>[o("确定")]),_:1},8,["onClick"])])]),default:r(()=>[o(" 确定封禁 "+b(a(v).username)+" 吗？ ",1)]),_:1},8,["modelValue"])])}}});const Ur=je(dr,[["__scopeId","data-v-c2f04a5a"]]);export{Ur as default};
